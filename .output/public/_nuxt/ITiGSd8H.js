import{N as ht,n as ft,l as p,c,o as u,s as x,d as N,a as t,t as f,z as it,g as rt,_ as gt,r as d,O as pt,j as mt,J as ut,Q as yt,m as dt,A as st,C as lt,R as bt,u as wt,F as q,y as Z,b as vt,S as _t,T as Ct}from"./BxhkHZUn.js";const kt=C=>{const L=ht(),{logout:$}=ft();return{buttonSize:p(()=>({"btn-small":C.size==="small","btn-medium":C.size==="medium","btn-large":C.size==="large"})),handleLogout:()=>{$(),L.push(C.redirectTo)}}},Dt={key:0,class:"logout-icon"},St={__name:"LogoutButton",props:{label:{type:String,default:"Logout"},size:{type:String,default:"medium",validator:C=>["small","medium","large"].includes(C)},showIcon:{type:Boolean,default:!1},redirectTo:{type:String,default:"/login"}},setup(C){const L=C,{buttonSize:$,handleLogout:F}=kt(L);return(v,r)=>(u(),c("button",{onClick:r[0]||(r[0]=(...O)=>rt(F)&&rt(F)(...O)),class:it(["logout-button",rt($)])},[C.showIcon?(u(),c("span",Dt,r[1]||(r[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[t("path",{"fill-rule":"evenodd",d:"M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"}),t("path",{"fill-rule":"evenodd",d:"M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"})],-1)]))):x("",!0),N(" "+f(C.label),1)],2))}},Tt={class:"transaction-chart-container"},xt={class:"chart-controls"},Lt={class:"control-group"},$t={class:"date-filter-container"},It={class:"date-range-text"},Ot={key:0,class:"date-picker-dropdown"},Rt={class:"date-picker-header"},At={class:"date-picker-body"},Et={class:"date-inputs"},zt={class:"date-input-group"},Pt=["max"],Ft={class:"date-input-group"},Ut=["max"],Nt={key:0,class:"error-message"},Mt={class:"chart-container"},Bt={key:0,class:"loading-overlay"},Vt={key:1,class:"no-data-message"},jt={class:"chart-wrapper",id:"chart-wrapper"},Wt={key:0,class:"chart-summary"},Ht={class:"summary-item"},Jt={class:"summary-value"},qt={class:"summary-item"},Qt={class:"summary-value"},Zt={class:"summary-item"},Gt={class:"summary-label"},Kt={class:"summary-value"},Xt={__name:"TransactionChart",emits:["dateRangeChanged","metricsUpdated"],setup(C,{expose:L,emit:$}){const F=$,v=d(null);let r=null;const O=d(!1),{$Chart:M}=pt(),E=d(null);O.value=!!M||!!window.Chart;const _=d(!0),y=d(""),h=d(""),R=d("day"),I=d(!0),A=d(!0),w=d(""),k=d(!1),G=p(()=>y.value&&h.value&&y.value===h.value),D=p(()=>{if(!y.value||!h.value)return!1;const a=new Date(y.value),e=new Date(h.value),n=Math.abs(e-a);return Math.floor(n/(1e3*60*60*24))<=1}),B=p(()=>new Date().toISOString().split("T")[0]),m=d({labels:[],transactionData:[],revenueData:[]}),V=p(()=>m.value.transactionData.some(a=>a>0)||m.value.revenueData.some(a=>a>0)),K=()=>{const a=new Date,e=new Date(a);e.setDate(a.getDate()-6),h.value=a.toISOString().split("T")[0],y.value=e.toISOString().split("T")[0]},X=()=>{if(w.value="",!y.value||!h.value){w.value="Please select a start and end date";return}const a=new Date(y.value),e=new Date(h.value);if(a>e){w.value="Start date cannot be after end date";return}const n=Math.abs(e-a);if(Math.ceil(n/(1e3*60*60*24))>30){w.value="The maximum date range is 31 days";return}o()},Y=a=>{if(!a)return a;const[e,n,b]=a.split("-").map(Number);return new Date(Date.UTC(e,n-1,b)).toISOString().split("T")[0]},tt=async()=>{_.value=!0;let a={period:D.value?"hour":"day"};if(a.startDate=Y(y.value),a.endDate=Y(h.value),!y.value||!h.value){_.value=!1;return}try{console.log("Fetching transaction stats with params:",a);const e={},n=await $fetch("/api/admin/transactions/stats",{params:a,headers:e});console.log("Transaction stats response:",n),n&&n.labels?m.value=n:(console.error("Invalid data format received from API:",n),m.value={labels:[],transactionData:[],revenueData:[]})}catch(e){console.error("Error fetching transaction stats:",e),m.value={labels:[],transactionData:[],revenueData:[]}}finally{_.value=!1}},et=a=>{E.value&&!E.value.contains(a.target)&&(k.value=!1)},z=p(()=>{if(!m.value||!m.value.labels||!V.value)return{labels:[],datasets:[{label:"No data available",data:[],backgroundColor:"transparent",borderColor:"transparent"}]};const a=[];return I.value&&a.push({label:"Transactions",data:m.value.transactionData,backgroundColor:"rgba(59, 130, 246, 0.1)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:3,pointBackgroundColor:"rgba(59, 130, 246, 1)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,tension:.4,fill:!0,yAxisID:"y"}),A.value&&a.push({label:"Revenue",data:m.value.revenueData,backgroundColor:"rgba(34, 197, 94, 0.1)",borderColor:"rgba(34, 197, 94, 1)",borderWidth:3,pointBackgroundColor:"rgba(34, 197, 94, 1)",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,tension:.4,fill:!0,yAxisID:"y1"}),{labels:m.value.labels,datasets:a}}),j=p(()=>m.value.transactionData.reduce((a,e)=>a+e,0)),U=p(()=>m.value.revenueData.reduce((a,e)=>a+e,0)),W=p(()=>{const a=U.value,e=m.value.revenueData.filter(n=>n>0).length;return e===0?0:Math.round(a/e)}),ot=p(()=>{switch(R.value){case"day":return"day";case"month":return"day";case"year":return"month";default:return"data"}});L({totalRevenue:U,totalTransactions:j,averageRevenue:W,transactionStats:m});const at=p(()=>{if(D.value){if(!y.value)return"Hourly Transactions";const a=new Date(y.value+"T00:00:00"),e=new Date(h.value+"T00:00:00");return G.value?`Hourly Transactions for ${a.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})}`:`Hourly Transactions: ${a.toLocaleDateString("id-ID",{day:"numeric",month:"short"})} - ${e.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})}`}return"Daily Transaction Overview"}),Q=p(()=>({responsive:!0,maintainAspectRatio:!1,devicePixelRatio:window.devicePixelRatio||1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{color:"#fff",usePointStyle:!0,padding:20,font:{size:14,weight:"500"}}},title:{display:!0,text:at.value,color:"#fff",font:{size:20,weight:"bold",family:"Inter, system-ui, sans-serif"}},tooltip:{backgroundColor:"rgba(10, 10, 15, 0.85)",backdropFilter:"blur(4px)",titleColor:"#fff",bodyColor:"#fff",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,displayColors:!0,padding:12,titleFont:{size:14,weight:"600"},bodyFont:{size:13,weight:"500"},callbacks:{title:function(a){const e=a[0];if(!e)return"";const n=e.label;return D.value?n:new Date(n+"T00:00:00").toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})},label:function(a){let e=a.dataset.label||"";return e&&(e+=": "),a.parsed.y!==null&&(a.dataset.yAxisID==="y1"?e+=H(a.parsed.y):e+=`${a.parsed.y.toLocaleString("id-ID")} transactions`),e}}}},scales:{x:{ticks:{color:"#fff",font:{size:12,weight:"500"},callback:function(a){const e=this.getLabelForValue(a);if(D.value){const b=e.split(" ");if(b.length>1){const T=b[1].split(":")[0],P=parseInt(T);return P%6===0||P===0?P===0?b[0]:b[1]:""}else{const T=e.split(":")[0];return parseInt(T)%3===0?e:""}}return new Date(e+"T00:00:00").toLocaleDateString("id-ID",{month:"short",day:"numeric"})},maxTicksLimit:D.value?8:10,autoSkip:!0},grid:{color:"rgba(255,255,255,0.12)",lineWidth:1}},y:{type:"linear",display:I.value,position:"left",beginAtZero:!0,ticks:{color:"#fff",font:{size:12,weight:"500"},callback:function(a){if(Number.isInteger(a))return a.toLocaleString("en-US")}},grid:{color:"rgba(255,255,255,0.12)",lineWidth:1}},y1:{type:"linear",display:A.value,position:"right",beginAtZero:!0,ticks:{color:"#fff",font:{size:12,weight:"500"},callback:function(a){return H(a)}},grid:{drawOnChartArea:!1,color:"rgba(255,255,255,0.12)",lineWidth:1}}},elements:{point:{hoverRadius:8,radius:6},line:{tension:.4}}})),H=a=>{const e=typeof a=="string"?parseFloat(a):a;return typeof e!="number"||isNaN(e)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},s=(a,e)=>{if(!a||!e)return"Select date range";const n=new Date(a),b=new Date(e),T={day:"numeric",month:"short",year:"numeric"},P=n.toLocaleDateString("en-US",T),nt=b.toLocaleDateString("en-US",T);return`${P} - ${nt}`},o=async()=>{const a={...m.value};if(await tt(),r)try{JSON.stringify(a)!==JSON.stringify(m.value)&&(r.data.labels=z.value.labels,r.data.datasets=z.value.datasets,r.options.plugins.title.text=at.value,r.update("none"),console.log("Chart updated successfully"))}catch(e){console.error("Error updating chart:",e),r=null,await l()}else await l()},l=async()=>{if(!window.Chart)try{await g()}catch(e){console.error("Failed to load Chart.js:",e);return}let a=v.value;if(a||(a=document.getElementById("transaction-chart"),console.log("Tried to find canvas by ID:",a)),!a){console.error("Chart canvas not found by any method");return}if(r)try{r.destroy(),r=null}catch(e){console.error("Error destroying existing chart:",e)}try{const e=a.getContext("2d");if(!e){console.error("Could not get 2D context from canvas");return}console.log("Creating new Chart instance with data:",z.value),r=new window.Chart(e,{type:"line",data:z.value,options:Q.value}),console.log("Chart instance created:",r)}catch(e){console.error("Error creating chart:",e)}},g=async()=>{if(window.Chart){console.log("Chart.js already loaded"),O.value=!0;return}console.log("Chart.js not loaded, attempting to load");try{await new Promise((a,e)=>{const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/chart.js",n.onload=()=>{console.log("Chart.js loaded successfully via script tag"),O.value=!0,a()},n.onerror=()=>{console.warn("Failed to load Chart.js via script tag, will try alternative method"),e()},document.head.appendChild(n)})}catch{console.warn("Loading Chart.js via script tag failed, trying alternative");try{const e=await bt(()=>import("https://cdn.jsdelivr.net/npm/chart.js/+esm"),[],import.meta.url);window.Chart=e.Chart,O.value=!0,console.log("Chart.js loaded successfully via dynamic import")}catch(e){throw console.error("All attempts to load Chart.js failed:",e),new Error("Failed to load Chart.js")}}},i=async()=>{console.log("Initializing chart..."),_.value=!0;try{if(v.value)console.log("Canvas ref available, creating chart"),S(v.value);else{console.log("Canvas not found, attempting to locate it by ID");const a=document.getElementById("transaction-chart");a?(console.log("Canvas found by ID"),S(a)):(console.log("Canvas not available yet, will try later via nextTick"),await ut(),v.value?(console.log("Canvas found after nextTick"),S(v.value)):(console.log("Canvas still not available after nextTick"),J()))}}catch(a){console.error("Error initializing chart:",a)}finally{_.value=!1}},S=a=>{try{if(!a||!a.getContext){console.error("Invalid canvas element");return}const e=M||window.Chart;if(!e){console.error("Chart library not available");return}const n=e.getChart(a);n&&n.destroy(),r&&(r=null),console.log("Creating new Chart instance with data:",z.value),r=new e(a,{type:"line",data:z.value,options:Q.value}),console.log("Chart instance created:",r)}catch(e){console.error("Error creating chart instance:",e)}},J=()=>{console.log("Starting canvas watcher");let a=0;const e=5;setTimeout(()=>{if(console.log("Checking chart instance after timeout"),r)return;const n=document.getElementById("transaction-chart");if(console.log("Chart instance not created yet, canvas ref now:",n),n)S(n);else{console.log("Chart canvas still not available after delay");try{const b=document.getElementById("chart-wrapper");if(!b)return;console.log("Watching chart wrapper for canvas");const T=new MutationObserver(P=>{for(const nt of P)if(nt.addedNodes.length){const ct=document.getElementById("transaction-chart");if(ct){console.log("Canvas detected by MutationObserver"),S(ct),T.disconnect(),console.log("Canvas watcher disconnected");return}}a++,a>=e&&(console.log(`Maximum retries (${e}) reached, disconnecting observer`),T.disconnect())});T.observe(b,{childList:!0,subtree:!0})}catch(b){console.error("Error setting up mutation observer:",b)}}},500)};return mt(async()=>{document.addEventListener("click",et),console.log("TransactionChart component mounted"),K();try{await g()}catch(a){console.error("Could not load Chart.js:",a)}if(console.log("Fetching transaction data"),await tt(),await new Promise(a=>setTimeout(a,100)),await ut(),console.log("DOM updated via nextTick, canvas ref:",v.value),v.value)try{await i()}catch(a){console.error("Error creating chart on first attempt:",a)}setTimeout(async()=>{console.log("Checking chart instance after timeout"),r||(console.log("Chart instance not created yet, canvas ref now:",v.value),v.value?(console.log("Creating chart on canvas element after timeout:",v.value),await i()):(console.error("Chart canvas still not available after delay"),J()))},800)}),yt(()=>{if(document.removeEventListener("click",et),r)try{r.destroy(),r=null}catch(a){console.error("Error destroying chart instance:",a)}}),dt([I,A],()=>{r&&(r.options=Q.value,r.update())},{deep:!0}),dt([U,j,W],()=>{F("metricsUpdated",{totalRevenue:U.value,totalOrders:j.value,avgOrderValue:W.value})},{immediate:!0}),(a,e)=>(u(),c("div",Tt,[t("div",xt,[t("div",Lt,[e[9]||(e[9]=t("label",{class:"control-label"},"Date Range",-1)),t("div",$t,[t("div",{class:"custom-date-range-picker",ref_key:"datePickerRef",ref:E},[t("button",{onClick:e[0]||(e[0]=n=>k.value=!k.value),class:"date-range-button"},[e[4]||(e[4]=t("i",{class:"fas fa-calendar-alt"},null,-1)),t("span",It,f(s(y.value,h.value)),1),t("i",{class:it(["fas fa-chevron-down",{"rotate-180":k.value}])},null,2)]),k.value?(u(),c("div",Ot,[t("div",Rt,[e[6]||(e[6]=t("h4",null,"Select Date Range",-1)),t("button",{onClick:e[1]||(e[1]=n=>k.value=!1),class:"close-btn"},e[5]||(e[5]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",At,[t("div",Et,[t("div",zt,[e[7]||(e[7]=t("label",null,"From:",-1)),st(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>y.value=n),type:"date",onChange:X,class:"date-input",max:B.value},null,40,Pt),[[lt,y.value]])]),t("div",Ft,[e[8]||(e[8]=t("label",null,"To:",-1)),st(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>h.value=n),type:"date",onChange:X,class:"date-input",max:B.value},null,40,Ut),[[lt,h.value]])])]),w.value?(u(),c("div",Nt,f(w.value),1)):x("",!0)])])):x("",!0)],512)])])]),t("div",Mt,[_.value?(u(),c("div",Bt,e[10]||(e[10]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Loading transaction data...",-1)]))):x("",!0),!_.value&&!V.value?(u(),c("div",Vt,e[11]||(e[11]=[t("p",null,"No transaction data available for the selected period.",-1)]))):x("",!0),t("div",jt,[t("canvas",{ref_key:"chartCanvas",ref:v,id:"transaction-chart"},null,512)])]),!_.value&&V.value?(u(),c("div",Wt,[t("div",Ht,[e[12]||(e[12]=t("span",{class:"summary-label"},"Total Transactions:",-1)),t("span",Jt,f(j.value),1)]),t("div",qt,[e[13]||(e[13]=t("span",{class:"summary-label"},"Total Revenue:",-1)),t("span",Qt,f(H(U.value)),1)]),t("div",Zt,[t("span",Gt,"Average per "+f(ot.value)+":",1),t("span",Kt,f(H(W.value)),1)])])):x("",!0)]))}},Yt=gt(Xt,[["__scopeId","data-v-82e655ae"]]),te={class:"admin-dashboard"},ee={key:0,class:"loading-container"},ae={class:"dashboard-header"},se={class:"dashboard-section dashboard-card"},oe={class:"stock-overview-container"},ne={class:"stock-overview-layout"},re={class:"stock-stats-left"},le={class:"stock-stats"},ie={class:"stat-item"},ce={class:"stat-number"},ue={key:0,class:"stat-item warning"},de={class:"stat-number"},ve={key:1,class:"stat-item danger"},he={class:"stat-number"},fe={key:0,class:"license-chart-right"},ge={class:"license-bars-horizontal"},me={class:"license-product-label-left"},pe={class:"license-product-name-full"},ye={class:"license-count-text"},be={class:"license-bar-horizontal-container"},we={key:0,class:"stock-list"},_e={class:"product-grid"},Ce={class:"product-name"},ke={class:"dashboard-section dashboard-card"},De={key:0,class:"chart-container"},Se={class:"chart-stats"},Te={class:"chart-stat"},xe={class:"chart-number"},Le={class:"chart-stat"},$e={class:"chart-number"},Ie={class:"chart-stat"},Oe={class:"chart-number"},Re={key:1,class:"loading-message"},Ae={class:"dashboard-section dashboard-card"},Ee={class:"table-selector"},ze={key:0,class:"table-container"},Pe={class:"table-info"},Fe={class:"data-table-wrapper"},Ue={class:"data-table"},Ne={key:1,class:"loading-message"},Me={class:"dashboard-footer"},Be={__name:"index",setup(C){const L=ht(),{user:$,initUser:F}=ft(),v=d([]),r=d([]),O=d([]),M=d([]),E=d(!0),_=d(!1),y=d(null),h=d(""),R=d([]),I=d([]),A=d(""),w=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),k=d({totalRevenue:w(0),totalOrders:"0",avgOrderValue:w(0)}),G=p(()=>$.value),D=p(()=>{const s=v.value.reduce((g,i)=>{const S=parseInt(i.total_licenses)||0;return g+S},0),o=v.value.filter(g=>{const i=g.stock||g.available_stock||0;return i>0&&i<=5}).length,l=v.value.filter(g=>(g.stock||g.available_stock||0)===0).length;return{totalLicenses:s,lowStock:o,outOfStock:l}}),B=p(()=>v.value.filter(s=>(s.stock||s.available_stock||0)<=5).slice(0,10)),m=p(()=>{if(!v.value.length)return[];const s=v.value.filter(l=>(l.total_licenses||0)>0).map(l=>({name:l.name,total:l.total_licenses||0,available:l.stock||l.available_stock||0}));if(!s.length)return[];const o=Math.max(...s.map(l=>l.total));return s.sort((l,g)=>g.total-l.total).slice(0,10).map(l=>({...l,percentage:Math.max(l.total/o*100,5)}))});p(()=>{const s=r.value.filter(g=>g.status==="completed").reduce((g,i)=>g+(parseFloat(i.total)||0),0),o=r.value.filter(g=>g.status==="completed").length,l=o>0?s/o:0;return{totalRevenue:w(s),totalOrders:o.toString(),avgOrderValue:w(l)}});const V=p(()=>!m.value||!Array.isArray(m.value)?[]:m.value.map(s=>({productName:s.name||"Unknown",totalLicenses:s.total||0,percentage:s.percentage||0}))),K=p(()=>!B.value||!Array.isArray(B.value)?[]:B.value.map(s=>{const o=s.stock||s.available_stock||0;return{id:s.id||Math.random(),productName:s.name||"Unknown Product",stockAmount:o,stockClass:o===0?"out-of-stock":"low-stock"}})),X=p(()=>{if(!A.value||!R.value.length)return R.value.slice(0,50);const s=A.value.toLowerCase();return R.value.filter(o=>Object.values(o).some(l=>l==null?!1:String(l).toLowerCase().includes(s))).slice(0,50)}),Y=async()=>{try{const s=await $fetch("/api/admin/tables/products");s&&s.success&&(v.value=s.data||[])}catch(s){console.error("Error loading products:",s),v.value=[]}},tt=async()=>{try{const s=await $fetch("/api/admin/transactions");s&&s.success&&(r.value=s.data||[])}catch(s){console.error("Error loading orders:",s),r.value=[]}},et=async()=>{try{const s=await $fetch("/api/admin/tables/categories");s&&s.success&&(O.value=s.data||[])}catch(s){console.error("Error loading categories:",s),O.value=[]}},z=async()=>{try{const s=await $fetch("/api/admin/tables/users");s&&s.success&&(M.value=s.data||[])}catch(s){console.error("Error loading users:",s),M.value=[]}},j=async()=>{if(!h.value){R.value=[],I.value=[];return}_.value=!0,A.value="";try{let s=[];switch(h.value){case"orders":s=r.value;break;case"users":s=M.value;break}if(R.value=s,s.length>0){const o=Object.keys(s[0]),l={orders:["id","user_name","user_email","product_name","total","status","created_at"],users:["id","name","email","account_type"]};I.value=l[h.value]||o.slice(0,6)}else I.value=[]}catch(s){console.error("Error loading table data:",s),R.value=[],I.value=[]}finally{_.value=!1}},U=s=>s.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()),W=(s,o)=>{if(s==null)return"-";if(o.includes("price")||o.includes("amount")||o.includes("total"))return w(parseFloat(s));if(o.includes("created_at")||o.includes("updated_at"))return new Date(s).toLocaleDateString();if(o.includes("email")){const l=s.split("@");if(l.length===2)return`${l[0].substring(0,3)}***@${l[1]}`}return typeof s=="string"&&s.length>50?s.substring(0,50)+"...":s},ot=()=>{L.push("/dashboard/add-product")},at=()=>{L.push("/dashboard/add-license")},Q=s=>{k.value={totalRevenue:w(s.totalRevenue||0),totalOrders:(s.totalOrders||0).toString(),avgOrderValue:w(s.avgOrderValue||0)}},H=async()=>{E.value=!0;try{await Promise.all([Y(),tt(),et(),z()])}catch(s){console.error("Error loading dashboard data:",s)}finally{E.value=!1}};return mt(async()=>{if(await F(),!$.value){L.push("/login");return}if($.value&&$.value.account_type!=="admin"){L.push("/home");return}await H()}),wt({title:"Admin Dashboard"}),(s,o)=>{var g;const l=St;return u(),c("div",te,[G.value?(u(),c(q,{key:1},[t("div",ae,[o[3]||(o[3]=t("h1",null,"Admin Dashboard",-1)),t("p",null,"Welcome, "+f(((g=G.value)==null?void 0:g.name)||"Admin")+"!",1)]),t("div",se,[t("div",{class:"section-header"},[o[6]||(o[6]=t("h2",null,[t("i",{class:"fas fa-boxes"}),N(" Stock Overview")],-1)),t("div",{class:"action-buttons"},[t("button",{onClick:ot,class:"action-btn add-product"},o[4]||(o[4]=[t("i",{class:"fas fa-plus"},null,-1),N(" Add Product ")])),t("button",{onClick:at,class:"action-btn add-license"},o[5]||(o[5]=[t("i",{class:"fas fa-key"},null,-1),N(" Add Licenses ")]))])]),t("div",oe,[t("div",ne,[t("div",re,[t("div",le,[t("div",ie,[t("span",ce,f(D.value.totalLicenses),1),o[7]||(o[7]=t("span",{class:"stat-label"},"Total Licenses",-1))]),D.value.lowStock>0?(u(),c("div",ue,[t("span",de,f(D.value.lowStock),1),o[8]||(o[8]=t("span",{class:"stat-label"},"Low Stock (â‰¤5)",-1))])):x("",!0),D.value.outOfStock>0?(u(),c("div",ve,[t("span",he,f(D.value.outOfStock),1),o[9]||(o[9]=t("span",{class:"stat-label"},"Out of Stock",-1))])):x("",!0)])]),!E.value&&V.value.length>0?(u(),c("div",fe,[o[10]||(o[10]=t("h3",null,[t("i",{class:"fas fa-chart-bar"}),N(" License Distribution")],-1)),t("div",ge,[(u(!0),c(q,null,Z(V.value,(i,S)=>(u(),c("div",{key:S,class:"license-bar-horizontal"},[t("div",me,[t("span",pe,f(i.productName),1),t("span",ye,f(i.totalLicenses)+" licenses",1)]),t("div",be,[t("div",{class:"license-bar-horizontal-fill",style:Ct({width:i.percentage+"%"})},null,4)])]))),128))])])):x("",!0)])]),K.value.length>0?(u(),c("div",we,[o[11]||(o[11]=t("h3",null,"Products Requiring Attention",-1)),t("div",_e,[(u(!0),c(q,null,Z(K.value,i=>(u(),c("div",{key:i.id,class:"product-item"},[t("span",Ce,f(i.productName),1),t("span",{class:it(["product-stock",i.stockClass])}," Stock: "+f(i.stockAmount),3)]))),128))])])):x("",!0)]),t("div",ke,[o[15]||(o[15]=t("h2",null,[t("i",{class:"fas fa-chart-line"}),N(" Transaction Analytics")],-1)),E.value?(u(),c("div",Re,"Loading analytics...")):(u(),c("div",De,[t("div",Se,[t("div",Te,[t("span",xe,f(k.value.totalRevenue),1),o[12]||(o[12]=t("span",{class:"chart-label"},"Total Revenue",-1))]),t("div",Le,[t("span",$e,f(k.value.totalOrders),1),o[13]||(o[13]=t("span",{class:"chart-label"},"Total Orders",-1))]),t("div",Ie,[t("span",Oe,f(k.value.avgOrderValue),1),o[14]||(o[14]=t("span",{class:"chart-label"},"Avg Order Value",-1))])]),vt(Yt,{ref_key:"transactionChartRef",ref:y,onMetricsUpdated:Q},null,512)]))]),t("div",Ae,[o[17]||(o[17]=t("h2",null,[t("i",{class:"fas fa-database"}),N(" Data Management")],-1)),t("div",Ee,[st(t("select",{"onUpdate:modelValue":o[0]||(o[0]=i=>h.value=i),onChange:j},o[16]||(o[16]=[t("option",{value:""},"Select a table to manage",-1),t("option",{value:"orders"},"Orders",-1),t("option",{value:"users"},"Users",-1)]),544),[[_t,h.value]])]),h.value&&!_.value?(u(),c("div",ze,[t("div",Pe,[t("h3",null,f(h.value.charAt(0).toUpperCase()+h.value.slice(1))+" ("+f(R.value.length)+" records)",1),st(t("input",{"onUpdate:modelValue":o[1]||(o[1]=i=>A.value=i),type:"text",placeholder:"Search records...",class:"search-input"},null,512),[[lt,A.value]])]),t("div",Fe,[t("table",Ue,[t("thead",null,[t("tr",null,[(u(!0),c(q,null,Z(I.value,i=>(u(),c("th",{key:i},f(U(i)),1))),128))])]),t("tbody",null,[(u(!0),c(q,null,Z(X.value,(i,S)=>(u(),c("tr",{key:i.id||S},[(u(!0),c(q,null,Z(I.value,J=>(u(),c("td",{key:J},f(W(i[J],J)),1))),128))]))),128))])])])])):_.value?(u(),c("div",Ne,"Loading table data...")):x("",!0)]),t("div",Me,[vt(l,{size:"large",label:"Logout","show-icon":""})])],64)):(u(),c("div",ee,o[2]||(o[2]=[t("div",{class:"loading-spinner"},[t("i",{class:"fas fa-spinner fa-spin"}),t("p",null,"Loading dashboard...")],-1)])))])}}},je=gt(Be,[["__scopeId","data-v-208d6b6b"]]);export{je as default};
