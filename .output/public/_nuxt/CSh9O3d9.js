import{_ as P,n as T,r as p,H as m,j as A,u as $,c as r,a as e,s as v,d as _,z as g,t as n,F as L,y as D,o as l,g as M,b as E,w as F,e as U}from"./BxhkHZUn.js";import{u as V}from"./YVwmBCuj.js";import"./DUhoTqhP.js";const B={class:"transactions-page-container"},J={class:"header-section"},z=["disabled"],H={key:0,class:"loading-container"},Y={key:1,class:"error-container"},j={key:2,class:"no-transactions"},q={key:3,class:"transactions-list"},Q={class:"transaction-header"},G={class:"order-info"},K={class:"order-date"},R={class:"transaction-details"},W={class:"product-info"},X={class:"product-details"},Z={key:0,class:"license-info"},I={class:"price"},ee={key:1,class:"midtrans-id"},se={class:"card-actions"},te=["onClick","disabled"],ae={__name:"index",setup(re){const{user:o,initUser:h}=T(),{formatCurrency:x}=V(),u=p([]),i=p(!0),d=p(null),c=p(!1),f=m({});m({});const k=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",b=s=>{switch(s){case"completed":return"status-success";case"pending":return"status-warning";case"failed":return"status-error";default:return"status-neutral"}},S=s=>{switch(s){case"completed":return"Completed";case"pending":return"Pending";case"failed":return"Failed";default:return s||"Unknown"}},w=s=>s.product_name?s.product_name:s.product&&s.product.name?s.product.name:`Product #${s.product_id}`,y=async()=>{if(!o.value){d.value="Please log in to view your orders",i.value=!1;return}try{i.value=!0,d.value=null;const s=await $fetch("/api/orders",{headers:{"x-user-session":JSON.stringify(o.value)}});u.value=s.transactions||[]}catch(s){console.error("Error fetching transactions:",s),d.value=s.message||"Failed to load orders"}finally{i.value=!1}},C=async s=>{if(o.value)try{f[s]=!0,(await $fetch("/api/orders/update-status",{method:"POST",body:{order_id:s},headers:{"x-user-session":JSON.stringify(o.value)}})).success&&await y()}catch(t){console.error("Error checking status:",t)}finally{f[s]=!1}},N=async(s=!1)=>{if(o.value)try{c.value=!0,(await $fetch("/api/orders/sync-all",{method:"POST",headers:{"x-user-session":JSON.stringify(o.value)}})).success&&await y()}catch(t){console.error("Error syncing transactions:",t)}finally{c.value=!1}};return A(async()=>{await h(),o.value?await y():(d.value="Please log in to view your orders",i.value=!1)}),$({title:"My Orders"}),(s,t)=>{const O=U;return l(),r("div",B,[e("div",J,[t[2]||(t[2]=e("h1",{class:"page-title galaxy-gradient-text"},"My Orders",-1)),!i.value&&u.value.length>0?(l(),r("button",{key:0,onClick:t[0]||(t[0]=a=>N()),class:"galaxy-button-secondary sync-btn",disabled:c.value,title:"Sync All Orders"},[e("i",{class:g(["fas fa-sync-alt",{spinning:c.value}])},null,2),t[1]||(t[1]=_(" Sync All "))],8,z)):v("",!0)]),i.value?(l(),r("div",H,t[3]||(t[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Loading your orders...",-1)]))):d.value?(l(),r("div",Y,[t[4]||(t[4]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),e("p",null,n(d.value),1),e("button",{onClick:y,class:"galaxy-button-primary"},"Try Again")])):u.value.length===0?(l(),r("div",j,t[5]||(t[5]=[e("i",{class:"fas fa-shopping-cart"},null,-1),e("h3",null,"No Orders Yet",-1),e("p",null,"You don't have any orders yet. Start shopping to see your orders here.",-1)]))):(l(),r("div",q,[(l(!0),r(L,null,D(u.value,a=>(l(),r("div",{key:a.id,class:"transaction-card galaxy-card"},[e("div",Q,[e("div",G,[e("h3",null,"Order #"+n(a.order_id||a.id),1),e("p",K,n(k(a.created_at)),1)]),e("div",{class:g(["status-badge",b(a.status)])},n(S(a.status)),3)]),e("div",R,[e("div",W,[e("div",X,[e("h4",null,"Product: "+n(w(a)),1),e("p",null,"Quantity: "+n(a.quantity),1),a.status==="completed"&&a.license_count>0?(l(),r("p",Z,[t[6]||(t[6]=e("i",{class:"fas fa-key"},null,-1)),_(" "+n(a.license_count)+" License"+n(a.license_count>1?"s":"")+" Available ",1)])):v("",!0),e("p",I,"Total: "+n(M(x)(a.total)),1),a.status==="failed"&&a.midtrans_order_id?(l(),r("p",ee,[t[7]||(t[7]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),_(" Midtrans Order: "+n(a.midtrans_order_id),1)])):v("",!0)])])]),e("div",se,[e("button",{onClick:ne=>C(a.id),class:"galaxy-button-secondary small",disabled:f[a.id],title:"Check Status"},[e("i",{class:g(["fas fa-sync",{"fa-spin":f[a.id]}])},null,2)],8,te),E(O,{to:`/orders/${a.order_id||a.id}`,class:"galaxy-button-primary small"},{default:F(()=>t[8]||(t[8]=[e("i",{class:"fas fa-eye"},null,-1),_(" Detail ")])),_:2,__:[8]},1032,["to"])])]))),128))]))])}}},de=P(ae,[["__scopeId","data-v-4954e2fb"]]);export{de as default};
