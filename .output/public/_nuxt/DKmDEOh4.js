import{_ as Y,G as $,E as O,H as N,r as h,l as c,j as q,c as l,s as u,A as B,g as a,a as e,K as E,z as w,t as d,v as P,w as v,e as V,o,d as k}from"./BxhkHZUn.js";const z={class:"payment-status-container"},A={key:0,class:"loading-overlay"},F={class:"icon-wrapper"},M={class:"status-title"},R={class:"status-message"},j={key:0,class:"order-details"},G={class:"detail-row"},H={class:"order-id"},K={key:0,class:"detail-row"},U={key:1,class:"detail-row"},W={class:"finish-actions"},J={__name:"finish",setup(Q){const y=$(),{success:S,info:m,error:r}=O(),s=N({order_id:y.query.order_id||"",status_code:y.query.status_code||"",transaction_status:y.query.transaction_status||"unknown"}),p=h(!1),f=h(null),i=c(()=>{switch(s.transaction_status.toLowerCase()){case"settlement":case"capture":return{class:"success",icon:"fas fa-check-circle",title:"Payment Successful!",message:"Your payment has been successfully processed. Thank you for your purchase!",isSuccess:!0};case"pending":return{class:"pending",icon:"fas fa-clock",title:"Payment Pending",message:"Your payment is being processed. Please wait for confirmation or check your payment method.",isSuccess:!1};case"deny":return{class:"error",icon:"fas fa-times-circle",title:"Payment Denied",message:"Your payment was denied by the payment provider. Please try again with a different payment method.",isSuccess:!1};case"cancel":return{class:"error",icon:"fas fa-ban",title:"Payment Cancelled",message:"Your payment was cancelled. If this was not intentional, please try again.",isSuccess:!1};case"expire":return{class:"error",icon:"fas fa-hourglass-end",title:"Payment Expired",message:"Your payment session has expired. Please create a new order to continue.",isSuccess:!1};case"failure":return{class:"error",icon:"fas fa-exclamation-triangle",title:"Payment Failed",message:"Payment processing failed. Please try again or contact support if the problem persists.",isSuccess:!1};default:return{class:"unknown",icon:"fas fa-question-circle",title:"Unknown Status",message:"We could not determine the payment status. Please contact support for assistance.",isSuccess:!1}}}),b=c(()=>i.value.class),x=c(()=>i.value.icon),T=c(()=>i.value.title),I=c(()=>i.value.message),_=c(()=>i.value.isSuccess);console.log("Payment finish page - Received data:",s);const D=async()=>{if(s.order_id)try{const t=await $fetch("/api/orders/get-transaction-id",{method:"POST",body:{order_id:s.order_id}});t.success&&t.transaction_id&&(f.value=t.transaction_id,console.log("Transaction ID found:",f.value))}catch(t){console.error("Failed to get transaction ID:",t)}},L=async()=>{if(s.transaction_status==="settlement"||s.transaction_status==="capture"){console.log("ðŸŽ¯ Auto-processing license for successful payment..."),p.value=!0;try{const t=await $fetch("/api/payment/auto-process-license",{method:"POST",body:{order_id:s.order_id,transaction_status:s.transaction_status}});t.success?(console.log("âœ… License auto-processing completed:",t),t.already_processed?(console.log(`ðŸ“ License already processed (${t.licenses_count} license(s))`),m("ðŸŽ‰ Payment successful! Your license & guide have been sent to your email.",6e3)):(console.log(`ðŸŽ‰ Successfully processed ${t.licenses_processed} license(s)`),S(`ðŸŽ‰ Payment successful! Your ${t.licenses_processed>1?"licenses & guides have":"license & guide has"} been sent to your email.`,8e3))):(console.log("âš ï¸ License auto-processing skipped:",t.message),m("Payment successful! Please check your email or contact support for license delivery.",6e3))}catch(t){console.error("âŒ License auto-processing failed:",t),r(`Payment successful but license delivery failed. Please contact support with Order ID: ${s.order_id}`,8e3)}finally{p.value=!1}}},C=()=>{switch(s.transaction_status.toLowerCase()){case"pending":m("Payment is pending. Please wait for confirmation.",5e3);break;case"deny":r("Payment was denied. Please try again with a different payment method.",6e3);break;case"cancel":r("Payment was cancelled.",4e3);break;case"expire":r("Payment session expired. Please create a new order.",6e3);break;case"failure":r("Payment failed. Please try again or contact support.",6e3);break}};return q(async()=>{s.order_id&&s.transaction_status&&(await D(),s.transaction_status==="settlement"||s.transaction_status==="capture"?L():C())}),(t,n)=>{const g=V;return o(),l("div",z,[a(p)?(o(),l("div",A,n[0]||(n[0]=[e("div",{class:"loading-container"},[e("div",{class:"loading-spinner"}),e("h2",{class:"loading-title"},"Processing License..."),e("p",{class:"loading-message"},"Please wait while we activate your license")],-1)]))):u("",!0),B(e("div",{class:w(["status-card",a(b)])},[e("div",F,[e("i",{class:w(a(x))},null,2)]),e("h1",M,d(a(T)),1),e("p",R,d(a(I)),1),a(s).order_id?(o(),l("div",j,[e("div",G,[n[1]||(n[1]=e("span",null,"Order ID:",-1)),e("span",H,d(a(s).order_id),1)]),a(s).status_code?(o(),l("div",K,[n[2]||(n[2]=e("span",null,"Status Code:",-1)),e("span",null,d(a(s).status_code),1)])):u("",!0),a(s).transaction_status?(o(),l("div",U,[n[3]||(n[3]=e("span",null,"Transaction Status:",-1)),e("span",null,d(a(s).transaction_status),1)])):u("",!0)])):u("",!0),e("div",W,[a(_)&&a(f)?(o(),P(g,{key:0,to:`/orders/${a(f)}`,class:"galaxy-button-primary"},{default:v(()=>n[4]||(n[4]=[e("i",{class:"fas fa-eye"},null,-1),k(" Detail Order ")])),_:1,__:[4]},8,["to"])):a(_)?(o(),P(g,{key:1,to:"/orders",class:"galaxy-button-primary"},{default:v(()=>n[5]||(n[5]=[e("i",{class:"fas fa-receipt"},null,-1),k(" Detail Order ")])),_:1,__:[5]})):u("",!0)])],2),[[E,!a(p)]])])}}},Z=Y(J,[["__scopeId","data-v-a99f09eb"]]);export{Z as default};
