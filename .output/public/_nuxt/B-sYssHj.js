import{p as F,_ as U,r as d,k as I,l as p,j as R,q as B,c as l,a as t,t as c,s as f,F as w,y as C,L as D,A as N,C as Q,g,i as H,o as i,z as j}from"./BxhkHZUn.js";import{u as z}from"./YVwmBCuj.js";import"./DUhoTqhP.js";const b=F("/placeholder-icon.png"),K={class:"checkout-page"},O={key:0,class:"loading-state"},Y={key:1,class:"error-state"},G={key:2,class:"product-checkout-container"},J={class:"checkout-header"},W={class:"product-name"},X={class:"checkout-grid"},Z={class:"product-info galaxy-card"},ee={class:"product-image-container"},te=["src","alt"],se={class:"product-details"},ne=["innerHTML"],oe={key:0,class:"product-features"},ae={class:"checkout-form galaxy-card"},re={key:0,class:"form-group"},le={class:"version-options"},ie=["onClick"],ue={class:"version-name"},ce={class:"version-price"},de={key:0,class:"version-badge"},pe={class:"form-group"},ve={class:"quantity-controls"},me={class:"price-summary"},ye={class:"summary-row"},fe={class:"summary-row"},ge={class:"summary-row total"},be={key:3,class:"no-product-found"},_e={__name:"checkout",setup(he){const V=B(),_=I(),E=H(),{formatCurrency:m}=z(),s=d(null),y=d(!0),v=d(null),u=d(1),r=d(null);console.log("Checkout page loaded with route params:",_.params);const x=p(()=>h.value*u.value),h=p(()=>{if(!s.value||!r.value)return 0;const o=s.value.versions.find(e=>e.id===r.value);return o?o.price:0}),q=p(()=>{if(!s.value||!r.value)return null;const o=s.value.versions.find(e=>e.id===r.value);return o?o.image_url:null}),k=p(()=>{var e,n;if(!s.value||!r.value)return((e=s.value)==null?void 0:e.name)||"";const o=s.value.versions.find(a=>a.id===r.value);return o?o.name:((n=s.value)==null?void 0:n.name)||""}),S=p(()=>{var e,n;if(!s.value||!r.value)return((e=s.value)==null?void 0:e.description)||"";const o=s.value.versions.find(a=>a.id===r.value);return o?o.description||"":((n=s.value)==null?void 0:n.description)||""}),P=async()=>{try{y.value=!0,v.value=null;const o=_.params.slug;if(!o)throw new Error("Missing product slug in URL");console.log("Fetching product details for slug:",o);try{const e=await $fetch("/api/products/checkout",{params:{slug:o}});if(console.log("API response received:",e),!e||!e.product)throw new Error("Product not found or invalid response format");s.value=e.product,s.value.versions&&s.value.versions.length>0&&(r.value=s.value.versions[0].id)}catch(e){throw console.error("API error:",e),new Error(`API error: ${e.message||"Unknown error"}`)}if(!s.value.features&&s.value.description){const e=s.value.description.match(/Features:(.*?)(?:\n\n|$)/s);if(e&&e[1]){const n=e[1].trim();s.value.features=n.split(`
`).map(a=>a.replace(/^[-•*]\s*/,"").trim()).filter(a=>a)}}console.log("Product data fetched:",s.value)}catch(o){v.value=o.message||"Failed to load product details",console.error("Error fetching product details:",o)}finally{y.value=!1}},T=o=>{r.value=o.id},$=()=>{u.value++},L=()=>{u.value>1&&u.value--},M=()=>{u.value<1&&(u.value=1)},A=async()=>{if(!s.value||u.value<1||!r.value){alert("Please select a product version and valid quantity.");return}if(!s.value.versions.find(e=>e.id===r.value)){alert("Please select a valid product version.");return}try{const e=s.value.versions.find(a=>a.id===r.value),n=await $fetch("/api/midtrans/initiate-transaction",{method:"POST",body:{product_id:e.id,product_name:`${s.value.name} ${e.version||""}`.trim(),price:e.price,quantity:u.value}});n.token?window.snap.pay(n.token,{onSuccess:function(a){alert("Payment successful!"),console.log(a),E.push("/")},onPending:function(a){alert("Payment pending. Please complete your payment."),console.log(a)},onError:function(a){alert("Payment failed. Please try again."),console.log(a)},onClose:function(){alert("Payment window closed. Your order is not complete.")}}):alert("Failed to get payment token.")}catch(e){console.error("Error initiating payment:",e),alert("Error initiating payment: "+(e.message||"Unknown error"))}};return R(()=>{P();const o="https://app.sandbox.midtrans.com/snap/snap.js",e=V.public.midtransClientKey;let n=document.createElement("script");n.src=o,n.setAttribute("data-client-key",e),document.body.appendChild(n)}),(o,e)=>(i(),l("div",K,[y.value?(i(),l("div",O,e[3]||(e[3]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"Loading product details...",-1)]))):v.value?(i(),l("div",Y,[e[4]||(e[4]=t("div",{class:"error-icon"},"!",-1)),e[5]||(e[5]=t("h2",null,"Error",-1)),t("p",null,c(v.value),1),t("button",{class:"galaxy-button-primary retry-btn",onClick:P},"Try Again")])):s.value?(i(),l("div",G,[t("div",J,[e[6]||(e[6]=t("h1",null,"Complete Your Purchase",-1)),t("p",W,c(k.value||s.value.name),1)]),t("div",X,[t("div",Z,[t("div",ee,[t("img",{src:q.value||s.value.image_url||"/placeholder-product.png",alt:k.value||s.value.name,class:"product-image",onError:e[0]||(e[0]=n=>n.target.src="/placeholder-product.png")},null,40,te)]),t("div",se,[t("div",{class:"product-description",innerHTML:S.value},null,8,ne),s.value.features?(i(),l("div",oe,[e[7]||(e[7]=t("h3",null,"Features",-1)),t("ul",null,[(i(!0),l(w,null,C(s.value.features,(n,a)=>(i(),l("li",{key:a},c(n),1))),128))])])):f("",!0)])]),t("div",ae,[e[14]||(e[14]=t("h2",null,"Order Summary",-1)),s.value.versions&&s.value.versions.length>1?(i(),l("div",re,[e[8]||(e[8]=t("label",{for:"version"},"Select Version",-1)),t("div",le,[(i(!0),l(w,null,C(s.value.versions,n=>(i(),l("button",{key:n.id,class:j(["version-btn",{active:r.value===n.id}]),onClick:a=>T(n)},[t("span",ue,c(n.name),1),t("span",ce,c(g(m)(n.price)),1),n.version==="365"?(i(),l("span",de,"Subscription")):f("",!0)],10,ie))),128))])])):f("",!0),t("div",pe,[e[9]||(e[9]=t("label",{for:"quantity"},"Quantity",-1)),t("div",ve,[t("button",{onClick:L,class:"quantity-btn"},"-"),N(t("input",{type:"number",id:"quantity","onUpdate:modelValue":e[1]||(e[1]=n=>u.value=n),min:"1",onChange:M,class:"quantity-input"},null,544),[[Q,u.value,void 0,{number:!0}]]),t("button",{onClick:$,class:"quantity-btn"},"+")])]),t("div",me,[t("div",ye,[e[10]||(e[10]=t("span",null,"Product Price",-1)),t("span",null,c(g(m)(h.value)),1)]),t("div",fe,[e[11]||(e[11]=t("span",null,"Quantity",-1)),t("span",null,c(u.value),1)]),t("div",ge,[e[12]||(e[12]=t("span",null,"Total Price",-1)),t("span",null,c(g(m)(x.value)),1)])]),t("button",{onClick:A,class:"galaxy-button-primary pay-button"},e[13]||(e[13]=[t("span",{class:"button-text"},"Complete Purchase",-1),t("span",{class:"button-icon"},"→",-1)])),e[15]||(e[15]=D('<div class="payment-info" data-v-b26da1b3><p data-v-b26da1b3>Secure payment processing by Midtrans</p><div class="payment-icons" data-v-b26da1b3><img src="'+b+'" alt="Visa" class="payment-icon" data-v-b26da1b3><img src="'+b+'" alt="Mastercard" class="payment-icon" data-v-b26da1b3><img src="'+b+'" alt="Bank Transfer" class="payment-icon" data-v-b26da1b3></div></div>',1))])])])):(i(),l("div",be,[e[16]||(e[16]=t("p",null,"Product not found.",-1)),t("button",{class:"galaxy-button-secondary",onClick:e[2]||(e[2]=n=>o.$router.push("/"))},"Return to Home")]))]))}},Ce=U(_e,[["__scopeId","data-v-b26da1b3"]]);export{Ce as default};
