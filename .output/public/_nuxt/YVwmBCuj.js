import{u as V}from"./DUhoTqhP.js";import{r as o,l as a}from"./BxhkHZUn.js";function X(){const{getAdminHeaders:_,checkAdminAccess:C}=V(),u=o(!1),l=o(null),n=o({}),i=a(()=>n.value.percentChange||{}),d=o([]),v=o({}),f=o([]),m=o(!1),D=a(()=>n.value.users||0),e=a(()=>n.value.products||0),c=a(()=>n.value.transactions||0),S=a(()=>n.value.totalRevenue||0),E=a(()=>n.value.activeProducts||0),N=a(()=>n.value.activeDeals||0),A=a(()=>n.value.activeUsers||0),P=a(()=>n.value.productsSold||n.value.usedLicenses||0),I=a(()=>c.value),H=a(()=>n.value.adminUsers||0),q=a(()=>n.value.recentTransactions||0),b=a(()=>i.value.totalOrders),U=a(()=>i.value.activeUsers),L=a(()=>i.value.productsSold),T=a(()=>i.value.totalRevenue),g=t=>t==null?"-":`${t>0?"+":""}${t}%`,k=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),K=t=>new Date(t).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=t=>({settlement:"success",pending:"warning",cancel:"danger",expire:"secondary",active:"success",inactive:"secondary"})[t]||"secondary",F=()=>{l.value=null},w=t=>{l.value=t,console.error("Admin Overview Error:",t)};let O=0,R="",p=null;const j=async(t,s,{forceRefresh:$=!1}={})=>{try{const y=`${t||""}|${s||""}`,M=Date.now();if(!$&&y===R&&M-O<5e3)return!0;if(!$&&p)return p;C(),u.value=!0,F();const h=new URLSearchParams;if(t){const r=new Date(t);r.setHours(0,0,0,0),h.append("startDate",r.toISOString())}if(s){const r=new Date(s);r.setHours(23,59,59,999),h.append("endDate",r.toISOString())}const x=h.toString()?`/api/admin/overview?${h.toString()}`:"/api/admin/overview";p=(async()=>{try{console.log("Fetching admin overview with date range:",{startDate:t,endDate:s}),console.log("API URL:",x);const r=await $fetch(x,{headers:_()});return console.log("Raw Admin Overview API Response:",r),r.success?(n.value={...r.data.statistics||{},percentChange:r.data.percentChange||{}},d.value=r.data.recentActivity||[],v.value=r.data.tables||{},console.log("Processed overview data:",{statistics:n.value,recentActivity:d.value,tablesInfo:v.value}),!0):(w(r.message||"Failed to fetch overview data"),!1)}catch(r){return w(r.message||"Failed to fetch overview data"),!1}finally{u.value=!1}})();const B=await p;return B&&(O=Date.now(),R=y),B}catch(y){return w(y.message||"Failed to fetch overview data"),!1}},z=t=>({users:"Users",products:"Products",categories:"Categories",transactions:"Transactions",product_license_base:"Product License Base",product_license_keys:"Product License Keys",product_license_accounts:"Product License Accounts",product_tags:"Product Tags",transaction_license:"Transaction License",payment_gateway_logs:"Payment Gateway Logs"})[t]||t.charAt(0).toUpperCase()+t.slice(1),G=t=>({users:"fas fa-users",products:"fas fa-box",categories:"fas fa-tags",transactions:"fas fa-credit-card",product_license_base:"fas fa-key",product_license_keys:"fas fa-key",product_license_accounts:"fas fa-user-lock",product_tags:"fas fa-tag",transaction_license:"fas fa-link",payment_gateway_logs:"fas fa-receipt"})[t]||"fas fa-table",Q=a(()=>[{title:"Total Orders",value:I.value,icon:"fas fa-shopping-cart",color:"purple",change:g(b.value)},{title:"Active Users",value:A.value,icon:"fas fa-users",color:"blue",change:g(U.value)},{title:"Products Sold",value:P.value,icon:"fas fa-box",color:"green",change:g(L.value)},{title:"Revenue",value:k(S.value),icon:"fas fa-chart-line",color:"gold",change:g(T.value)}]);async function J(){try{f.value=[],m.value=!0;const t=await $fetch("/api/admin/tables/products",{query:{orderBy:"name",orderDir:"asc",pageSize:1e3}});if(t&&t.success&&Array.isArray(t.data))f.value=t.data.map(s=>({...s,stock:s.available_stock!==void 0?s.available_stock:s.stock||0,total_licenses:s.total_licenses||0,used_licenses:s.used_licenses||0,expired_licenses:s.expired_licenses||0,reserved_licenses:s.reserved_licenses||0}));else throw new Error("Invalid products data received")}catch(t){console.error("Error loading products:",t)}finally{m.value=!1}}return{loading:u,error:l,statistics:n,percentChange:i,recentActivity:d,tablesInfo:v,products:f,productsLoading:m,totalUsers:D,totalProducts:e,totalTransactions:c,totalOrders:I,totalRevenue:S,activeProducts:E,activeDeals:N,adminUsers:H,activeUsersCount:A,productsSold:P,ordersChange:b,activeUsersChange:U,productsSoldChange:L,revenueChange:T,recentTransactionsCount:q,getQuickStats:Q,clearError:F,fetchOverview:j,formatCurrency:k,formatDate:K,getStatusBadgeClass:W,getTableDisplayName:z,getTableIcon:G,loadProducts:J}}function ee(){const{getTableIcon:_}=X();return{getTableIcon:_,formatColumnName:e=>e?e.split("_").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" "):"",isDateColumn:e=>e.name.includes("_at")||e.name.includes("date")||e.name.includes("expires"),isBooleanColumn:e=>e.name==="send_license"?!1:e.type==="tinyint(1)"||e.name.startsWith("is_")||["active","featured","trending"].includes(e.name),isStatusColumn:e=>e.name==="status"||e.name.endsWith("_status"),isCurrencyColumn:e=>["price","amount","old_price","new_price"].includes(e.name)||e.name.includes("_price"),isLongText:e=>e&&typeof e=="string"&&e.length>25,truncateText:(e,c=25)=>!e||typeof e!="string"?e:e.length>c?e.substring(0,c)+"...":e,formatDate:e=>{if(!e)return"";try{const c={day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(e).toLocaleDateString("id-ID",c)}catch{return e}},formatStatus:e=>!e||typeof e!="string"?"":e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),formatCurrency:e=>e==null?"":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}}export{ee as u};
