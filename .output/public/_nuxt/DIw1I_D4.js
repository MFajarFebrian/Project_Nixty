import{E as z,r as f,_ as O,l as T,m as q,c,o as p,s as L,a as e,g as I,M as x,t as S,z as W,d as V,N as G,j as K,u as R,A as M,C as A,S as H,F as Y,y as J,D as X,b as Z}from"./BxhkHZUn.js";import{u as Q}from"./DUhoTqhP.js";function ee(){const{getAdminHeaders:D,checkAdminAccess:E}=Q(),l=z(),v=f(!1),n=f(null),u=f(0),w=5*1024*1024,$=["image/jpeg","image/jpg","image/jfif","image/png","image/gif","image/webp"],y=()=>{n.value=null},m=s=>{n.value=s,console.error("Image Upload Error:",s)},C=s=>(y(),s?$.includes(s.type.toLowerCase())?s.size>w?(m("File too large. Maximum size is 5MB."),!1):!0:(m("Invalid file type. Only JPEG, PNG, GIF, and WebP are allowed."),!1):(m("No file selected"),!1));return{uploading:v,error:n,progress:u,MAX_FILE_SIZE:w,ALLOWED_TYPES:$,clearError:y,validateFile:C,uploadImage:async s=>{try{if(console.log("Starting image upload:",s.name,s.size,s.type),E(),!C(s))return null;v.value=!0,u.value=0,y();const i=new FormData;i.append("image",s),console.log("FormData created, uploading to server..."),console.log("File details:",{name:s.name,size:s.size,type:s.type}),console.log("FormData entries:");for(let[k,N]of i.entries())console.log(`  ${k}:`,N);console.log("Admin headers:",D());const d=D();delete d["Content-Type"];const b=await fetch("/api/admin/upload-image",{method:"POST",headers:d,body:i});if(console.log("Upload response status:",b.status),!b.ok){const k=await b.text();throw console.error("Upload error response:",k),new Error(`Upload failed: ${b.status} ${b.statusText}`)}const U=await b.json();if(console.log("Upload response:",U),U.success)return u.value=100,l.success("Image uploaded successfully!"),U.data;{const k=U.message||"Failed to upload image";return m(k),l.error(k),null}}catch(i){const d=i.message||"Failed to upload image";return m(d),l.error(d),null}finally{v.value=!1,setTimeout(()=>{u.value=0},1e3)}},deleteImage:async s=>{try{if(E(),y(),!s||!s.startsWith("/uploads/admin/"))return m("Invalid image URL"),!1;const i=await $fetch("/api/admin/delete-image",{method:"DELETE",headers:D(),query:{url:s}});if(i.success)return l.success("Image deleted successfully!"),!0;{const d=i.message||"Failed to delete image";return m(d),l.error(d),!1}}catch(i){const d=i.message||"Failed to delete image";return m(d),l.error(d),!1}},formatFileSize:s=>{if(s===0)return"0 Bytes";const i=1024,d=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(s)/Math.log(i));return parseFloat((s/Math.pow(i,b)).toFixed(2))+" "+d[b]},getFileExtension:s=>s.slice((s.lastIndexOf(".")-1>>>0)+2),isUploadedImage:s=>s&&s.startsWith("/uploads/admin/"),getThumbnailUrl:(s,i="small")=>s}}const ae={class:"image-upload-container"},te={key:0,class:"current-image"},se={class:"image-preview"},oe=["src","alt"],le={class:"image-overlay"},re=["accept","disabled"],ne={key:0,class:"upload-content"},ie={class:"upload-text"},ue={key:1,class:"uploading-content"},de={key:1,class:"error-message"},ce={class:"modal-actions"},pe=["disabled"],me={key:0,class:"fas fa-spinner fa-spin"},ge={key:1,class:"fas fa-trash"},fe={__name:"ImageUpload",props:{modelValue:{type:String,default:""},label:{type:String,default:"Image"},required:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(D,{emit:E}){const l=D,v=E,{uploading:n,error:u,progress:w,ALLOWED_TYPES:$,clearError:y,uploadImage:m,deleteImage:C,isUploadedImage:r}=ee(),a=f(null),t=f(!1),g=f(!1),P=f(!1),_=T(()=>l.modelValue),s=T(()=>$.join(",")),i=T(()=>2*Math.PI*26);T(()=>i.value-w.value/100*i.value);const d=()=>{var h;n.value||(h=a.value)==null||h.click()},b=async h=>{var F;const o=(F=h.target.files)==null?void 0:F[0];o&&await B(o)},U=()=>{n.value||(t.value=!0)},k=()=>{t.value=!1},N=async h=>{if(t.value=!1,n.value)return;const o=h.dataTransfer.files;o.length>0&&await B(o[0])},B=async h=>{const o=await m(h);o&&(_.value&&r(_.value)&&await C(_.value),v("update:modelValue",o.url)),a.value&&(a.value.value="")},j=async()=>{if(_.value){P.value=!0;try{r(_.value)?await C(_.value)&&v("update:modelValue",""):v("update:modelValue","")}finally{P.value=!1,g.value=!1}}};return q(()=>l.modelValue,()=>{y()}),(h,o)=>(p(),c("div",ae,[_.value?(p(),c("div",te,[e("div",se,[e("img",{src:_.value,alt:D.label,class:"preview-img"},null,8,oe),e("div",le,[e("button",{onClick:o[0]||(o[0]=F=>g.value=!0),class:"delete-btn",type:"button"},o[5]||(o[5]=[e("i",{class:"fas fa-trash"},null,-1)]))])])])):L("",!0),e("div",{class:W(["upload-area",{dragover:t.value,uploading:I(n)}])},[e("input",{ref_key:"fileInput",ref:a,type:"file",accept:s.value,onChange:b,class:"file-input",disabled:I(n)},null,40,re),e("div",{class:"upload-zone",onClick:d,onDragover:x(U,["prevent"]),onDragleave:x(k,["prevent"]),onDrop:x(N,["prevent"])},[I(n)?(p(),c("div",ue,[o[7]||(o[7]=e("i",{class:"fas fa-spinner fa-spin upload-icon"},null,-1)),e("span",null,S(I(w))+"%",1)])):(p(),c("div",ne,[o[6]||(o[6]=e("i",{class:"fas fa-cloud-upload-alt upload-icon"},null,-1)),e("span",ie,S(_.value?"Replace":"Upload"),1)]))],32)],2),I(u)?(p(),c("div",de,[o[9]||(o[9]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),e("span",null,S(I(u)),1),e("button",{onClick:o[1]||(o[1]=(...F)=>I(y)&&I(y)(...F)),class:"close-error"},o[8]||(o[8]=[e("i",{class:"fas fa-times"},null,-1)]))])):L("",!0),g.value?(p(),c("div",{key:2,class:"modal-overlay",onClick:o[4]||(o[4]=F=>g.value=!1)},[e("div",{class:"confirm-modal",onClick:o[3]||(o[3]=x(()=>{},["stop"]))},[o[10]||(o[10]=e("div",{class:"modal-header"},[e("h3",null,"Delete Image")],-1)),o[11]||(o[11]=e("div",{class:"modal-body"},[e("p",null,"Are you sure you want to delete this image? This action cannot be undone.")],-1)),e("div",ce,[e("button",{onClick:o[2]||(o[2]=F=>g.value=!1),class:"cancel-btn"},"Cancel"),e("button",{onClick:j,class:"delete-confirm-btn",disabled:P.value},[P.value?(p(),c("i",me)):(p(),c("i",ge)),V(" "+S(P.value?"Deleting...":"Delete"),1)],8,pe)])])])):L("",!0)]))}},ve=O(fe,[["__scopeId","data-v-0ed430bb"]]),ye={class:"add-product-page"},be={class:"form-container"},we={class:"form-group"},_e={class:"form-group"},he={class:"form-row"},Ce={class:"form-group"},ke={class:"form-group"},Ie={class:"category-input-group"},De=["value"],Ee=["onKeydown"],Fe=["disabled"],$e={key:0},Pe={key:1},Ue={class:"form-group"},Ve={class:"form-actions"},xe=["disabled"],Me={key:0},Se={key:1},Te={__name:"add-product",setup(D){const E=G(),l=f({name:"",description:"",price:0,category_id:"",version:"",stock:0,image_url:""}),v=f([]),n=f(!1),u=f(""),w=f(!1),$=async()=>{try{const r=await $fetch("/api/admin/tables/categories");r&&r.success&&(v.value=r.data||[])}catch(r){console.error("Error loading categories:",r)}},y=async()=>{if(!u.value.trim())return;const r=z();w.value=!0;const a=u.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();try{const t=await $fetch("/api/admin/tables/categories",{method:"POST",body:{name:u.value,slug:a}});if(t&&t.success)v.value.push(t.data),u.value="",l.value.category_id=t.data.id,r.success("Category created successfully!");else throw new Error((t==null?void 0:t.message)||"Failed to create category")}catch(t){console.error("Error creating category:",t),r.error("Error creating category: "+t.message)}finally{w.value=!1}},m=async()=>{n.value=!0;try{const r=z();if(!l.value.name||!l.value.price||!l.value.category_id){r.error("Please fill in all required fields"),n.value=!1;return}if(parseFloat(l.value.price)<=0){r.error("Price must be greater than 0"),n.value=!1;return}const a=l.value.name.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),t={name:l.value.name,description:l.value.description,price:parseFloat(l.value.price),category_id:parseInt(l.value.category_id),image_url:l.value.image_url,slug:a,status:"active"};console.log("Creating product with data:",t);const g=await $fetch("/api/admin/tables/products",{method:"POST",body:t});if(g&&g.success)r.success("Product created successfully!"),E.push("/dashboard");else throw new Error((g==null?void 0:g.message)||"Failed to create product")}catch(r){console.error("Error creating product:",r),z().error("Error creating product: "+r.message)}finally{n.value=!1}},C=()=>{E.push("/dashboard")};return K(async()=>{await $()}),R({title:"Add New Product - Admin"}),(r,a)=>(p(),c("div",ye,[e("div",{class:"page-header"},[a[7]||(a[7]=e("h1",null,[e("i",{class:"fas fa-plus-circle"}),V(" Add New Product")],-1)),e("button",{onClick:C,class:"back-btn"},a[6]||(a[6]=[e("i",{class:"fas fa-arrow-left"},null,-1),V(" Back to Dashboard ")]))]),e("div",be,[e("form",{onSubmit:x(m,["prevent"]),class:"product-form"},[e("div",we,[a[8]||(a[8]=e("label",{for:"productName"},"Product Name *",-1)),M(e("input",{type:"text",id:"productName","onUpdate:modelValue":a[0]||(a[0]=t=>l.value.name=t),required:"",placeholder:"Enter product name"},null,512),[[A,l.value.name]])]),e("div",_e,[a[9]||(a[9]=e("label",{for:"productDescription"},"Description",-1)),M(e("textarea",{id:"productDescription","onUpdate:modelValue":a[1]||(a[1]=t=>l.value.description=t),rows:"4",placeholder:"Enter product description"},null,512),[[A,l.value.description]])]),e("div",he,[e("div",Ce,[a[10]||(a[10]=e("label",{for:"productPrice"},"Price *",-1)),M(e("input",{type:"number",id:"productPrice","onUpdate:modelValue":a[2]||(a[2]=t=>l.value.price=t),required:"",min:"0",step:"0.01",placeholder:"0.00"},null,512),[[A,l.value.price]])]),e("div",ke,[a[13]||(a[13]=e("label",{for:"productCategory"},"Category *",-1)),e("div",Ie,[M(e("select",{id:"productCategory","onUpdate:modelValue":a[3]||(a[3]=t=>l.value.category_id=t),required:""},[a[11]||(a[11]=e("option",{value:""},"Select Category",-1)),(p(!0),c(Y,null,J(v.value,t=>(p(),c("option",{key:t.id,value:t.id},S(t.name),9,De))),128))],512),[[H,l.value.category_id]]),M(e("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=t=>u.value=t),placeholder:"New category name",onKeydown:X(x(y,["prevent"]),["enter"])},null,40,Ee),[[A,u.value]]),e("button",{type:"button",onClick:y,class:"create-category-btn",disabled:w.value||!u.value.trim()},[w.value?(p(),c("span",$e,a[12]||(a[12]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),V(" Creating... ")]))):(p(),c("span",Pe,"Add Category"))],8,Fe)])])]),e("div",Ue,[a[14]||(a[14]=e("label",{for:"productImage"},"Product Image",-1)),Z(ve,{modelValue:l.value.image_url,"onUpdate:modelValue":a[5]||(a[5]=t=>l.value.image_url=t),label:"Product Image"},null,8,["modelValue"])]),e("div",Ve,[e("button",{type:"button",onClick:C,class:"cancel-btn"}," Cancel "),e("button",{type:"submit",disabled:n.value,class:"submit-btn"},[n.value?(p(),c("span",Me,a[15]||(a[15]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),V(" Creating... ")]))):(p(),c("span",Se,a[16]||(a[16]=[e("i",{class:"fas fa-plus"},null,-1),V(" Create Product ")])))],8,xe)])],32)])]))}},Ne=O(Te,[["__scopeId","data-v-9f259507"]]);export{Ne as default};
