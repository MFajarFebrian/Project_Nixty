import{_ as D,n as K,E as J,r as d,u as L,j,c as i,a,b as T,v as z,s as R,w as U,x as G,I as H,o,t as h,g as p,d as q,P as Q,A as P,z as c,D as m,C as k,J as W}from"./BxhkHZUn.js";import{u as X}from"./YVwmBCuj.js";import"./DUhoTqhP.js";const Y={class:"profile-page-container"},Z={key:0,class:"state-container"},ee={key:1,class:"state-container"},se={class:"error-text"},ae={key:2,class:"state-container"},te={key:3,class:"profile-content galaxy-card"},le={class:"profile-header"},ne={class:"profile-picture-container"},oe={class:"user-info"},ie={class:"user-name"},ue={class:"user-email"},re={class:"profile-details"},de={class:"detail-item editable"},ve={class:"detail-value-container"},pe=["disabled"],ce={key:1,class:"detail-value"},me=["disabled","title"],ge={key:0,class:"fas fa-spinner fa-spin"},fe={key:1,class:"fas fa-edit"},he={class:"detail-item editable"},ye={class:"detail-value-container"},be=["disabled"],we={key:1,class:"detail-value"},_e=["disabled","title"],Pe={key:0,class:"fas fa-spinner fa-spin"},ke={key:1,class:"fas fa-edit"},xe={class:"detail-item editable"},$e={class:"detail-value-container"},Ce=["disabled"],Ee={key:1,class:"detail-value"},Ne=["disabled","title"],Ie={key:0,class:"fas fa-spinner fa-spin"},Ae={key:1,class:"fas fa-edit"},Se={class:"detail-item editable"},Te={class:"detail-value-container"},Ue=["disabled"],Ve={key:1,class:"detail-value"},Be=["disabled","title"],Me={key:0,class:"fas fa-spinner fa-spin"},Fe={key:1,class:"fas fa-edit"},Oe={__name:"index",setup(De){const{user:r,initUser:V,setUser:I}=K();X();const{success:A,error:g}=J(),x=d(!0),y=d(null),b=d(!1),u=d(null),n=d({changePassword:""}),l=d(null),$=d(null),C=d(null),E=d(null),N=d(null),w=async s=>{u.value&&u.value!==s&&v(u.value),u.value=s,s==="changePassword"?n.value.changePassword="":n.value[s]=r.value[s]||"",await W(),s==="name"&&$.value?$.value.focus():s==="email"&&C.value?C.value.focus():s==="phone"&&E.value?E.value.focus():s==="changePassword"&&N.value&&N.value.focus()},v=s=>{u.value===s&&(u.value=null,s==="changePassword"?n.value.changePassword="":n.value[s]=r.value[s]||"")},_=async s=>{if(l.value!==s){l.value=s;try{if(s==="changePassword"){if(!M(n.value.changePassword)){g("Password must be at least 6 characters long"),u.value=null,n.value.changePassword="";return}const f=await $fetch("/api/profile/change-password",{method:"POST",headers:{"Content-Type":"application/json","x-user-session":JSON.stringify(r.value)},body:{newPassword:n.value.changePassword}});f.success?(A("🔐 Password changed successfully!"),u.value=null,n.value.changePassword=""):(g(f.message||"Failed to change password"),u.value=null,n.value.changePassword="");return}if(!n.value[s]&&s!=="phone"){g(`${s.charAt(0).toUpperCase()+s.slice(1)} cannot be empty`),v(s);return}if(s==="email"&&!B(n.value[s])){g("Please enter a valid email address"),v(s);return}if(n.value[s]===r.value[s]){u.value=null;return}const e=await $fetch("/api/profile/update",{method:"POST",headers:{"Content-Type":"application/json","x-user-session":JSON.stringify(r.value)},body:{[s]:n.value[s]}});if(e.success){const f={...r.value,[s]:n.value[s]};I(f),u.value=null,A({name:"👤 Name updated successfully!",email:"📧 Email updated successfully!",phone:"📱 Phone number updated successfully!"}[s]||"Profile updated successfully!")}else g(e.message||"Failed to update profile"),v(s)}catch(e){console.error("Error updating profile:",e),g("An error occurred while updating your profile"),v(s)}finally{l.value=null}}},B=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),M=s=>s&&s.length>=6,S=async()=>{x.value=!0,y.value=null;try{if(V(),!r.value)return;const s=await $fetch("/api/profile",{method:"GET",headers:{"x-user-session":JSON.stringify(r.value)}});s.success?I(s.user):y.value=s.message||"Failed to fetch profile data"}catch(s){console.error("Error fetching profile data:",s),y.value=s.message||"An unexpected error occurred."}finally{x.value=!1}},F=()=>{b.value=!0},O=()=>{b.value=!1,S()};return L({title:"Profile"}),j(()=>{S()}),(s,e)=>{const f=H;return o(),i("div",Y,[e[29]||(e[29]=a("h1",{class:"page-title galaxy-gradient-text"},"My Profile",-1)),T(f,null,{fallback:U(()=>e[28]||(e[28]=[a("div",{class:"state-container"},[a("div",{class:"spinner"}),a("p",null,"Loading profile data...")],-1)])),default:U(()=>[x.value?(o(),i("div",Z,e[20]||(e[20]=[a("div",{class:"spinner"},null,-1),a("p",null,"Loading profile data...",-1)]))):y.value?(o(),i("div",ee,[a("p",se,"❌ "+h(y.value),1)])):p(r)?(o(),i("div",te,[a("div",le,[a("div",ne,[T(Q,{src:null,alt:p(r).name,userName:p(r).name,userId:p(r).id,customFallback:!0,class:"profile-picture"},null,8,["alt","userName","userId"])]),a("div",oe,[a("h2",ie,h(p(r).name||"N/A"),1),a("p",ue,h(p(r).email),1)])]),a("div",re,[e[27]||(e[27]=a("h3",null,"Account Details",-1)),a("div",de,[e[23]||(e[23]=a("span",{class:"detail-label"},"Name:",-1)),a("div",ve,[u.value==="name"?P((o(),i("input",{key:0,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.name=t),onBlur:e[1]||(e[1]=t=>_("name")),onKeyup:[e[2]||(e[2]=m(t=>t.target.blur(),["enter"])),e[3]||(e[3]=m(t=>v("name"),["escape"]))],class:c(["edit-input",{saving:l.value==="name"}]),disabled:l.value==="name",ref_key:"nameInput",ref:$},null,42,pe)),[[k,n.value.name]]):(o(),i("span",ce,h(p(r).name||"N/A"),1)),a("button",{onClick:e[4]||(e[4]=t=>w("name")),class:c(["edit-icon-btn",{saving:l.value==="name"}]),disabled:l.value==="name"||u.value==="name",title:l.value==="name"?"Saving...":"Edit name"},[l.value==="name"?(o(),i("i",ge)):(o(),i("i",fe))],10,me)])]),a("div",he,[e[24]||(e[24]=a("span",{class:"detail-label"},"Email:",-1)),a("div",ye,[u.value==="email"?P((o(),i("input",{key:0,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.email=t),onBlur:e[6]||(e[6]=t=>_("email")),onKeyup:[e[7]||(e[7]=m(t=>t.target.blur(),["enter"])),e[8]||(e[8]=m(t=>v("email"),["escape"]))],class:c(["edit-input",{saving:l.value==="email"}]),disabled:l.value==="email",type:"email",ref_key:"emailInput",ref:C},null,42,be)),[[k,n.value.email]]):(o(),i("span",we,h(p(r).email),1)),a("button",{onClick:e[9]||(e[9]=t=>w("email")),class:c(["edit-icon-btn",{saving:l.value==="email"}]),disabled:l.value==="email"||u.value==="email",title:l.value==="email"?"Saving...":"Edit email"},[l.value==="email"?(o(),i("i",Pe)):(o(),i("i",ke))],10,_e)])]),a("div",xe,[e[25]||(e[25]=a("span",{class:"detail-label"},"Phone Number:",-1)),a("div",$e,[u.value==="phone"?P((o(),i("input",{key:0,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.phone=t),onBlur:e[11]||(e[11]=t=>_("phone")),onKeyup:[e[12]||(e[12]=m(t=>t.target.blur(),["enter"])),e[13]||(e[13]=m(t=>v("phone"),["escape"]))],class:c(["edit-input",{saving:l.value==="phone"}]),disabled:l.value==="phone",type:"tel",ref_key:"phoneInput",ref:E},null,42,Ce)),[[k,n.value.phone]]):(o(),i("span",Ee,h(p(r).phone||"Not set"),1)),a("button",{onClick:e[14]||(e[14]=t=>w("phone")),class:c(["edit-icon-btn",{saving:l.value==="phone"}]),disabled:l.value==="phone"||u.value==="phone",title:l.value==="phone"?"Saving...":"Edit phone number"},[l.value==="phone"?(o(),i("i",Ie)):(o(),i("i",Ae))],10,Ne)])]),a("div",Se,[e[26]||(e[26]=a("span",{class:"detail-label"},"Change Password:",-1)),a("div",Te,[u.value==="changePassword"?P((o(),i("input",{key:0,"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.changePassword=t),onBlur:e[16]||(e[16]=t=>_("changePassword")),onKeyup:[e[17]||(e[17]=m(t=>t.target.blur(),["enter"])),e[18]||(e[18]=m(t=>v("changePassword"),["escape"]))],class:c(["edit-input",{saving:l.value==="changePassword"}]),disabled:l.value==="changePassword",type:"password",placeholder:"Enter new password",ref_key:"changePasswordInput",ref:N},null,42,Ue)),[[k,n.value.changePassword]]):(o(),i("span",Ve,"••••••••")),a("button",{onClick:e[19]||(e[19]=t=>w("changePassword")),class:c(["edit-icon-btn",{saving:l.value==="changePassword"}]),disabled:l.value==="changePassword"||u.value==="changePassword",title:l.value==="changePassword"?"Saving...":"Change password"},[l.value==="changePassword"?(o(),i("i",Me)):(o(),i("i",Fe))],10,Be)])])])])):(o(),i("div",ae,[e[22]||(e[22]=a("p",{class:"no-data-text"},"Please log in to view your profile.",-1)),a("button",{onClick:F,class:"galaxy-button-primary"},e[21]||(e[21]=[a("i",{class:"fas fa-sign-in-alt"},null,-1),q(" Login ")]))]))]),_:1}),b.value?(o(),z(G,{key:0,"is-open":b.value,"default-tab":"login",onClose:O},null,8,["is-open"])):R("",!0)])}}},je=D(Oe,[["__scopeId","data-v-1ec52a96"]]);export{je as default};
